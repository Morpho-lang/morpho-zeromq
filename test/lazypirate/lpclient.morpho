
import zeromq 

print "Starting client..."

var requestimeout = 2500 // msecs, (>1000!)
var maxretries =  3 // Before we abandon
var server_endpoint = "tcp://127.0.0.1:5555"

var client = ZeroMQRequest(server_endpoint)
var poller = ZeroMQPoller(client) 

for (i in 1..6) {
  for (retry in 1..maxretries) {
    client.send("Hello ${i}") 
    var rcvd = poller.wait(requestimeout) 
    if (rcvd==client) {
      var a = client.receive() 
      var j = Int(a.split(" ")[1])
      print "Client received reply: ${j} (expecting ${i})"
      break 
    } else {
      print "Timed out"
    }
  }
}

print "Ending client"